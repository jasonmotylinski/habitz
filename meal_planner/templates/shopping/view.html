{% extends "base.html" %}

{% block title %}{{ shopping_list.store_name }} - Meal Planner{% endblock %}

{% block content %}
<div class="shopping-container">
    <!-- Header -->
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--spacing-lg); gap: var(--spacing-md);">
        <div>
            <h1 style="margin: 0;">ğŸ›’ {{ shopping_list.store_name }}</h1>
        </div>
        <a href="{{ url_for('shopping.index') }}" class="btn btn-soft" style="white-space: nowrap;">â† Back</a>
    </div>

    <!-- Progress Bar -->
    {% if items %}
    <div class="shopping-progress">
        <div class="progress-bar">
            <div class="progress-bar-fill" style="width: {{ (completed/total*100) if total > 0 else 0 }}%"></div>
        </div>
        <div class="progress-text">{{ completed }} of {{ total }} items</div>
    </div>
    {% endif %}

    <!-- Actions -->
    {% if items %}
    <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); flex-wrap: wrap;">
        <a href="{{ url_for('shopping.add_item', id=shopping_list.id) }}" class="btn btn-primary">â• Add Item</a>
        <!-- Generate from Meals - Hidden for now, functionality preserved -->
        <form method="POST" action="{{ url_for('shopping.generate_from_meals', id=shopping_list.id) }}" style="display: none;">
            <button type="submit" class="btn btn-secondary">ğŸ”„ Generate from Meals</button>
        </form>
        <form method="POST" action="{{ url_for('shopping.clear_list', id=shopping_list.id) }}" style="display: inline;" onsubmit="return confirm('Clear all items from this list? This cannot be undone.');">
            <button type="submit" class="btn btn-outline" style="color: var(--terracotta); border-color: var(--terracotta);">ğŸ—‘ï¸ Clear List</button>
        </form>
    </div>
    {% endif %}

    <!-- Shopping Items -->
    {% if items %}
        <div class="shopping-items">
            {% for item in items %}
                <div class="shopping-item {% if item.is_checked %}checked{% endif %}" style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md); background: white; border: 1px solid var(--light-gray); border-radius: var(--radius-md); margin-bottom: var(--spacing-sm); transition: all 0.2s ease;">
                    <div style="display: flex; align-items: center; flex: 1; gap: var(--spacing-sm);">
                        <input type="checkbox"
                               class="shopping-checkbox"
                               data-item-id="{{ item.id }}"
                               {% if item.is_checked %}checked{% endif %}>
                        <span class="item-text">{{ item.item_name }}</span>
                        {% if item.quantity %}
                            <span class="item-quantity">{{ item.quantity }}{% if item.unit %} {{ item.unit }}{% endif %}</span>
                        {% endif %}
                    </div>
                    <button type="button" class="delete-item-btn"
                            onclick="deleteItem({{ item.id }}, event)"
                            style="background: none; border: none; color: var(--terracotta); cursor: pointer; padding: 0.25rem 0.5rem; font-size: 1.25rem; transition: all 0.2s ease; opacity: 0.6;"
                            onmouseover="this.style.opacity='1'"
                            onmouseout="this.style.opacity='0.6'"
                            title="Delete item">
                        âœ•
                    </button>
                </div>
            {% endfor %}
        </div>

        <!-- Clear all checked -->
        <div style="margin-top: var(--spacing-lg); text-align: center; padding-top: var(--spacing-lg); border-top: 1px solid var(--light-gray);">
            <small>
                <a href="{{ url_for('shopping.index', week=shopping_list.week_start_date.isoformat()) }}" style="color: var(--sage-green); text-decoration: none;">
                    All done? Back to shopping lists âœ“
                </a>
            </small>
        </div>

    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ›’</div>
            <h3>No items yet</h3>
            <p>Add items to your shopping list.</p>
            <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
                <a href="{{ url_for('shopping.add_item', id=shopping_list.id) }}" class="btn btn-primary">Add Item</a>
                <!-- Generate from Meals - Hidden for now, functionality preserved -->
                <form method="POST" action="{{ url_for('shopping.generate_from_meals', id=shopping_list.id) }}" style="display: none;">
                    <button type="submit" class="btn btn-secondary">Generate from Meals</button>
                </form>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/shopping.js') }}"></script>
{% endblock %}
